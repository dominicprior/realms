local updateInterval = 2.0
local timeSinceLastUpdate = 2.0
local currZone = "no zone yet"

local realmData = {
    [500]="en  Aggramar",
    [501]="en  Arathor",
    [502]="en  Aszune",
    [503]="en  Azjol-Nerub",
    [504]="en  Bloodhoof",
    [505]="en  Doomhammer",
    [506]="en  Draenor",
    [507]="en  Dragonblight",
    [508]="en  Emerald Dream",
    [509]="fr  Garona",
    [510]="fr  Vol'jin",
    [511]="en  Sunstrider",
    [512]="fr  Arak-arahm",
    [513]="en  Twilight's Hammer",
    [515]="en  Zenedar",
    [516]="de RP Forscherliga",
    [517]="fr  Medivh",
    [518]="en  Agamaggan",
    [519]="en  Al'Akir",
    [521]="en  Bladefist",
    [522]="en  Bloodscalp",
    [523]="en  Burning Blade",
    [524]="en  Burning Legion",
    [525]="en  Crushridge",
    [526]="en  Daggerspine",
    [527]="en  Deathwing",
    [528]="en  Dragonmaw",
    [529]="en  Dunemaul",
    [531]="de  Dethecus",
    [533]="fr  Sinstralis",
    [535]="de  Durotan",
    [536]="en RP Argent Dawn",
    [537]="fr RP Kirin Tor",
    [538]="fr  Dalaran",
    [539]="fr  Archimonde",
    [540]="fr  Elune",
    [541]="fr  Illidan",
    [542]="fr  Hyjal",
    [543]="fr  Kael'thas",
    [544]="fr  Ner’zhul",
    [545]="fr  Cho’gall",
    [546]="fr  Sargeras",
    [547]="en  Runetotem",
    [548]="en  Shadowsong",
    [549]="en  Silvermoon",
    [550]="en  Stormrage",
    [551]="en  Terenas",
    [552]="en  Thunderhorn",
    [553]="en  Turalyon",
    [554]="en  Ravencrest",
    [556]="en  Shattered Hand",
    [557]="en  Skullcrusher",
    [558]="en  Spinebreaker",
    [559]="en  Stormreaver",
    [560]="en  Stormscale",
    [561]="en RP Earthen Ring",
    [562]="de  Alexstrasza",
    [563]="de  Alleria",
    [564]="de  Antonidas",
    [565]="de  Baelgun",
    [566]="de  Blackhand",
    [567]="de  Gilneas",
    [568]="de  Kargath",
    [569]="de  Khaz'goroth",
    [570]="de  Lothar",
    [571]="de  Madmortem",
    [572]="de  Malfurion",
    [573]="de  Zuluhed",
    [574]="de  Nozdormu",
    [575]="de  Perenolde",
    [576]="de RP Die Silberne Hand",
    [577]="de  Aegwynn",
    [578]="de  Arthas",
    [579]="de  Azshara",
    [580]="de  Blackmoore",
    [581]="de  Blackrock",
    [582]="de  Destromath",
    [583]="de  Eredar",
    [584]="de  Frostmourne",
    [585]="de  Frostwolf",
    [586]="de  Gorgonnash",
    [587]="de  Gul'dan",
    [588]="de  Kel'Thuzad",
    [589]="de  Kil'jaeden",
    [590]="de  Mal'Ganis",
    [591]="de  Mannoroth",
    [592]="de RP Zirkel des Cenarius",
    [593]="de  Proudmoore",
    [594]="de  Nathrezim",
    [600]="de  Dun Morogh",
    [601]="de  Aman'thul",
    [602]="de  Sen'jin",
    [604]="de  Thrall",
    [605]="de  Theradras",
    [606]="en  Genjuros",
    [607]="en  Balnazzar",
    [608]="de  Anub'arak",
    [609]="de  Wrathbringer",
    [610]="de  Onyxia",
    [611]="de  Nera'thor",
    [612]="de  Nefarian",
    [613]="de RP Kult der Verdammten",
    [614]="de RP Das Syndikat",
    [615]="de  Terrordar",
    [616]="de  Krag'jin",
    [617]="de RP Der Rat von Dalaran",
    [618]="en  Nordrassil",
    [619]="en  Hellscream",
    [621]="en  Laughing Skull",
    [622]="en  Magtheridon",
    [623]="en  Quel'Thalas",
    [624]="en  Neptulon",
    [625]="en  Twisting Nether",
    [626]="en  Ragnaros",
    [627]="en  The Maelstrom",
    [628]="en  Sylvanas",
    [629]="en  Vashj",
    [630]="en  Bloodfeather",
    [631]="en  Darksorrow",
    [632]="en  Frostwhisper",
    [633]="en  Kor'gall",
    [635]="en RP Defias Brotherhood",
    [636]="en RP The Venture Co",
    [637]="en  Lightning's Blade",
    [638]="en  Haomarush",
    [639]="en  Xavius",
    [640]="fr  Khaz Modan",
    [641]="fr  Drek'Thar",
    [642]="fr  Rashgarroth",
    [643]="fr  Throk'Feroth",
    [644]="fr RP Conseil des Ombres",
    [645]="fr  Varimathras",
    [646]="en  Hakkar",
    [647]="fr RP Les Sentinelles",
    [1080]="en  Khadgar",
    [1081]="en  Bronzebeard",
    [1082]="en  Kul Tiras",
    [1083]="en  Chromaggus",
    [1084]="en  Dentarg",
    [1085]="en RP Moonglade",
    [1086]="fr RP La Croisade écarlate",
    [1087]="en  Executus",
    [1088]="en  Trollbane",
    [1089]="en  Mazrigos",
    [1090]="en  Talnivarr",
    [1091]="en  Emeriss",
    [1092]="en  Drak'thul",
    [1093]="en  Ahn'Qiraj",
    [1096]="en RP Scarshield Legion",
    [1097]="de  Ysera",
    [1098]="de  Malygos",
    [1099]="de  Rexxar",
    [1104]="de  Anetheron",
    [1105]="de  Nazjatar",
    [1106]="de  Tichondrius",
    [1117]="en RP Steamwheedle Cartel",
    [1118]="de RP Die ewige Wacht",
    [1119]="de RP Die Todeskrallen",
    [1121]="de RP Die Arguswacht",
    [1122]="fr  Uldaman",
    [1123]="fr  Eitrigg",
    [1127]="fr RP Confrérie du Thorium",
    [1298]="en  Vek'nilash",
    [1299]="en  Boulderfist",
    [1300]="en  Frostmane",
    [1301]="en  Outland",
    [1303]="en  Grim Batol",
    [1304]="en  Jaedenar",
    [1305]="en  Kazzak",
    [1306]="en  Tarren Mill",
    [1307]="en  Chamber of Aspects",
    [1308]="en RP Ravenholdt",
    [1309]="it  Pozzo dell'Eternità",
    [1310]="en  Eonar",
    [1311]="en  Kilrogg",
    [1312]="en  Aerie Peak",
    [1313]="en  Wildhammer",
    [1314]="en  Saurfang",
    [1316]="itIT  Nemesis",
    [1317]="en RP Darkmoon Faire",
    [1318]="de  Vek'lor",
    [1319]="de  Mug'thol",
    [1320]="de  Taerar",
    [1321]="de  Dalvengyr",
    [1322]="de  Rajaxx",
    [1323]="de  Ulduar",
    [1324]="de  Malorne",
    [1326]="de RP Der Abyssische Rat",
    [1327]="de RP Der Mithrilorden",
    [1328]="de  Tirion",
    [1330]="de  Ambossar",
    [1331]="fr  Suramar",
    [1332]="fr  Krasus",
    [1333]="de RP Die Nachtwache",
    [1334]="fr  Arathi",
    [1335]="fr  Ysondre",
    [1336]="fr  Eldre'Thalas",
    [1337]="fr RP Culte de la Rive noire",
    [1378]="es  Dun Modr",
    [1379]="es  Zul'jin",
    [1380]="es  Uldum",
    [1381]="es  C'Thun",
    [1382]="es  Sanguino",
    [1383]="es  Shen'dralar",
    [1384]="es  Tyrande",
    [1385]="es  Exodar",
    [1386]="es  Minahonda",
    [1387]="es  Los Errantes",
    [1388]="en  Lightbringer",
    [1389]="en  Darkspear",
    [1391]="en  Alonsus",
    [1392]="en  Burning Steppes",
    [1393]="en  Bronze Dragonflight",
    [1394]="en  Anachronos",
    [1395]="es  Colinas Pardas",
    [1400]="de  Un'Goro",
    [1401]="de  Garrosh",
    [1404]="de  Area 52",
    [1405]="de RP Todeswache",
    [1406]="de  Arygos",
    [1407]="de  Teldrassil",
    [1408]="de  Norgannon",
    [1409]="de  Lordaeron",
    [1413]="en  Aggra (Português)",
    [1415]="en  Terokkar",
    [1416]="en  Blade's Edge",
    [1417]="en  Azuremyst",
    [1587]="en  Hellfire",
    [1588]="en  Ghostlands",
    [1589]="en  Nagrand",
    [1595]="en RP The Sha'tar",
    [1596]="en  Karazhan",
    [1597]="en  Auchindoun",
    [1598]="en  Shattered Halls",
    [1606]="en RP Sporeggar",
    [1607]="de  Nethersturm",
    [1608]="de  Shattrath",
    [1611]="de  Festung der Stürme",
    [1612]="de  Echsenkessel",
    [1613]="de  Blutkessel",
    [1618]="de RP Die Aldor",
    [1619]="de RP Das Konsortium",
    [1620]="fr  Chants éternels",
    [1621]="fr  Marécage de Zangar",
    [1622]="fr  Temple noir",
    [1624]="fr  Naxxramas",
    [1626]="fr RP Les Clairvoyants",
    [4440]="de  Everlook",
    [4441]="fr  Auberdine",
    [4442]="de  Lakeshire",
    [4453]="en  Pyrewood Village",
    [4455]="de  Razorfen",
    [4456]="en  Nethergarde Keep",
    [4458]="en  Mirage Raceway",
    [4463]="de PvP Heartstriker",
    [4464]="fr PvP Sulfuron",
    [4465]="en PvP Golemagg",
    [4466]="de PvP Patchwerk",
    [4467]="en PvP Firemaw",
    [4475]="en PvP Shazzrah",
    [4476]="en PvP Gehennas",
    [4477]="de PvP Venoxis",
    [4478]="en PvP Razorgore",
    [4676]="en PvP RP Zandalar Tribe",
    [4678]="en RP Hydraxian Waterlords",
    [4701]="en PvP Mograine",
    [4702]="en PvP Gandling",
    [4703]="fr PvP Amnennar",
    [4705]="en PvP Stonespire",
    [4706]="en PvP Flamelash",
    [4741]="en PvP Noggenfogger",
    [4742]="en PvP Ashbringer",
    [4743]="en PvP Skullflame",
    [4744]="fr PvP Finkle",
    [4745]="de PvP Transcendence",
    [4746]="en PvP Bloodfang",
    [4749]="en PvP Earthshaker",
    [4751]="en PvP Dragonfang",
    [4755]="en PvP Dreadmist",
    [4756]="de PvP Dragon's Call",
    [4757]="en PvP Ten Storms",
    [4758]="en PvP Judgement",
    [4759]="de RP Celebras",
    [4763]="de PvP Heartstriker",
    [4813]="es PvP Mandokir",
    }


local realms = { }
realms[4456] = "en - Nethergarde Keep"

-- Updates the dungeon note if enough time has elapsed
-- and if we are in a new zone.

function onupdate(self, elapsed)
    timeSinceLastUpdate = timeSinceLastUpdate + elapsed;
    if timeSinceLastUpdate > updateInterval then
        updateNotes()
        timeSinceLastUpdate = 0
    end
end

-- Updates the dungeon note if we are in a new zone.

function updateNotes()
    local newZone = GetZoneText()
    if newZone ~= currZone then
        currZone = newZone
        local note = findRealms()
        TestAddon3_MainFrame_xCoorNum:SetText(note)
    end
end

-- Returns the realms.

function findRealms()
    return findRealm("party1") .. findRealm("party2") .. findRealm("party3") .. findRealm("party4")
end

function findRealm(unit)
    local guid = UnitGUID(unit)  -- e.g. "Player-4456-..."
    if not guid then return "" end
    local _, realmNumStr = strsplit("-", guid)
    local realmNum = tonumber(realmNumStr)
    local realmInfo = realmData[realmNum]
    if realmInfo then
        return realmInfo .. "\n"
    else
        return realmNumStr .. "\n"
    end
end



-- local _, _, _, _, _, _, realm = GetPlayerInfoByGUID(guid)
-- local name, rules, locale, region, timezone = strsplit(",", info)

--    [4456]="Nethergarde Keep,PvE,enUS,EU",
